<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Smash Fit OS | Ultimate Dashboard</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&family=JetBrains+Mono:wght@500&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons+Round" rel="stylesheet">

    <style>
        /* ==================== 1. MODERN DESIGN TOKENS ==================== */
        :root {
            --bg-body: #09090b;
            --bg-sidebar: #121214;
            --bg-card: #18181b;
            --bg-hover: #27272a;
            
            --primary: #22C55E;
            --primary-glow: rgba(34, 197, 94, 0.4);
            --primary-dim: rgba(34, 197, 94, 0.1);
            
            --secondary: #3B82F6;
            --danger: #EF4444;
            --warning: #F59E0B;
            
            --text-main: #FAFAFA;
            --text-secondary: #A1A1AA;
            --text-muted: #52525B;
            
            --border: 1px solid rgba(255, 255, 255, 0.08);
            --radius: 16px;
            --nav-w: 260px;
        }

        * { box-sizing: border-box; margin: 0; padding: 0; outline: none; -webkit-tap-highlight-color: transparent; }
        
        body {
            background-color: var(--bg-body);
            color: var(--text-main);
            font-family: 'Inter', sans-serif;
            height: 100vh;
            overflow: hidden;
            display: flex;
        }

        /* Typography */
        h1, h2, h3 { font-weight: 700; letter-spacing: -0.02em; color: var(--text-main); }
        .text-accent { color: var(--primary); }
        .font-mono { font-family: 'JetBrains Mono', monospace; }
        .text-sm { font-size: 0.875rem; color: var(--text-secondary); }
        .text-xs { font-size: 0.75rem; color: var(--text-secondary); }

        /* UI Elements */
        .btn {
            display: inline-flex; align-items: center; justify-content: center; gap: 8px;
            padding: 10px 20px; border-radius: 10px; font-weight: 600; font-size: 0.9rem;
            cursor: pointer; transition: 0.2s; border: 1px solid transparent;
        }
        .btn:active { transform: scale(0.98); }
        .btn-primary { background: var(--primary); color: #000; box-shadow: 0 0 20px var(--primary-dim); }
        .btn-primary:hover { filter: brightness(1.1); box-shadow: 0 0 30px var(--primary-dim); }
        .btn-ghost { background: rgba(255,255,255,0.05); color: var(--text-main); border: var(--border); }
        .btn-ghost:hover { background: var(--bg-hover); }
        .full-width { width: 100%; }

        /* Modern Cards */
        .card {
            background: var(--bg-card); border-radius: var(--radius); padding: 24px;
            border: var(--border); position: relative; overflow: hidden;
        }
        
        /* BENTO GRID SYSTEM */
        .bento-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            grid-template-rows: auto auto; /* Adaptive rows */
            gap: 20px;
            padding-bottom: 40px;
        }
        .span-1 { grid-column: span 1; }
        .span-2 { grid-column: span 2; }
        .span-3 { grid-column: span 3; }
        .span-4 { grid-column: span 4; }
        
        /* Mobile Bento Adjustment */
        @media (max-width: 1024px) {
            .bento-grid { grid-template-columns: repeat(2, 1fr); }
            .span-1, .span-2, .span-3 { grid-column: span 2; } /* Full width on mobile */
            .span-4 { grid-column: span 2; }
        }

        /* CSS Charts */
        .chart-container {
            display: flex; align-items: flex-end; justify-content: space-between;
            height: 120px; margin-top: 20px; padding-top: 20px; border-top: 1px dashed rgba(255,255,255,0.1);
        }
        .bar {
            width: 12%; border-radius: 4px; background: var(--bg-hover);
            transition: height 0.5s ease; position: relative;
        }
        .bar:hover { background: var(--primary); }
        .bar.active { background: var(--primary); box-shadow: 0 0 15px var(--primary-glow); }

        /* Activity Feed */
        .activity-item {
            display: flex; align-items: center; gap: 12px; padding: 12px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .activity-item:last-child { border-bottom: none; }
        .activity-icon {
            width: 32px; height: 32px; border-radius: 8px; background: var(--bg-hover);
            display: grid; place-items: center; color: var(--text-secondary);
        }

        /* Inputs */
        input, select {
            width: 100%; padding: 12px; background: #000; border: var(--border);
            border-radius: 8px; color: #fff; margin-bottom: 15px; font-size: 0.95rem;
        }
        input:focus { border-color: var(--primary); }

        /* Layout */
        .app-shell { display: flex; width: 100%; height: 100%; }
        .sidebar {
            width: var(--nav-width); background: var(--bg-sidebar); border-right: var(--border);
            padding: 24px; display: flex; flex-direction: column; z-index: 50;
        }
        .main-content {
            flex: 1; padding: 30px; overflow-y: auto;
            background: radial-gradient(circle at top right, #131316 0%, #09090b 50%);
        }

        /* Nav Items */
        .nav-item {
            padding: 12px 16px; margin-bottom: 4px; border-radius: 10px; cursor: pointer;
            color: var(--text-secondary); display: flex; align-items: center; gap: 12px;
            font-weight: 500; transition: 0.2s;
        }
        .nav-item:hover, .nav-item.active { background: var(--bg-hover); color: var(--text-main); }
        .nav-item.active { border-left: 3px solid var(--primary); }

        /* Mobile Nav */
        .mobile-nav { display: none; }
        @media (max-width: 768px) {
            .sidebar { display: none; }
            .mobile-nav {
                display: flex; position: fixed; bottom: 0; left: 0; width: 100%; height: 70px;
                background: rgba(18, 18, 20, 0.95); backdrop-filter: blur(10px);
                border-top: var(--border); z-index: 100; justify-content: space-around; align-items: center;
            }
            .main-content { padding: 20px; padding-bottom: 90px; }
            .nav-btn { background: none; border: none; color: var(--text-secondary); display: flex; flex-direction: column; align-items: center; font-size: 0.7rem; gap: 4px; }
            .nav-btn.active { color: var(--primary); }
        }

        /* Modals & Overlay */
        #modal-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.8); backdrop-filter: blur(4px);
            z-index: 2000; display: none; align-items: center; justify-content: center;
        }
        #toast {
            position: fixed; bottom: 30px; right: 30px; background: var(--bg-card);
            border-left: 4px solid var(--primary); padding: 16px 24px; border-radius: 8px;
            z-index: 9999; transform: translateY(100px); transition: 0.3s cubic-bezier(0.16, 1, 0.3, 1);
            box-shadow: 0 10px 40px rgba(0,0,0,0.5); font-weight: 600;
        }

        .hidden { display: none !important; }
        .flex-between { display: flex; justify-content: space-between; align-items: center; }
        .badge { padding: 4px 8px; border-radius: 6px; font-size: 0.7rem; font-weight: 700; text-transform: uppercase; background: var(--bg-hover); }
    </style>
</head>
<body>

    <div id="toast">Action Successful</div>

    <div id="modal-overlay">
        <div id="modal-content" class="card" style="width: 90%; max-width: 480px; box-shadow: 0 20px 50px rgba(0,0,0,0.5);"></div>
    </div>

    <section id="auth-screen" style="position:fixed; top:0; left:0; width:100%; height:100%; z-index:5000; display:flex; align-items:center; justify-content:center;">
        <div class="card" style="width:100%; max-width:400px; padding:40px; text-align:center;">
            <div style="margin-bottom:40px;">
                <div style="width:64px; height:64px; background:var(--primary); border-radius:16px; display:grid; place-items:center; margin:0 auto 20px; box-shadow:0 0 40px var(--primary-glow);">
                    <i class="material-icons-round" style="font-size:32px; color:#000;">bolt</i>
                </div>
                <h2>Smash Fit <span class="text-accent">OS</span></h2>
                <p class="text-sm">Enterprise Dashboard</p>
            </div>

            <form id="login-form">
                <input type="email" id="login-email" value="admin@smashfit.com" required>
                <input type="password" id="login-pass" value="123" required>
                <button type="submit" class="btn btn-primary full-width">Sign In</button>
            </form>
            
            <button onclick="App.factoryReset()" class="btn btn-ghost full-width" style="margin-top:20px; border:none; color:var(--danger); opacity:0.6; font-size:0.8rem;">
                <i class="material-icons-round" style="font-size:14px;">refresh</i> Reset Database
            </button>
        </div>
    </section>

    <div id="app-shell" class="app-shell hidden">
        
        <aside class="sidebar">
            <div style="display:flex; align-items:center; gap:12px; margin-bottom:40px; padding-left:10px;">
                <div style="width:32px; height:32px; background:var(--primary); border-radius:8px; display:grid; place-items:center;"><i class="material-icons-round" style="font-size:20px; color:#000;">bolt</i></div>
                <h3 style="font-size:1.1rem;">Smash Fit</h3>
            </div>
            
            <ul id="sidebar-nav" style="list-style:none; padding:0; flex:1;"></ul>
            
            <div class="card" style="padding:12px; margin:0; display:flex; align-items:center; gap:12px; background:#000; border:none;">
                <div style="width:36px; height:36px; background:linear-gradient(45deg, var(--secondary), #60A5FA); border-radius:50%; display:grid; place-items:center; font-weight:700; font-size:0.9rem;">
                    <span id="user-initial">A</span>
                </div>
                <div style="flex:1; overflow:hidden;">
                    <div id="user-name" style="font-size:0.85rem; font-weight:600;">Admin</div>
                    <div id="user-role" style="font-size:0.7rem; color:var(--text-secondary);">ADMIN</div>
                </div>
                <i class="material-icons-round" onclick="location.reload()" style="cursor:pointer; color:var(--text-muted);">logout</i>
            </div>
        </aside>

        <main class="main-content" id="main-view"></main>

        <nav class="mobile-nav" id="mobile-nav"></nav>
    </div>

    <script>
        // --- 1. LOCAL DB ---
        const DB = {
            init() {
                if(!localStorage.getItem('sf_users_v7')) {
                    const users = [
                        { id: 'admin@smashfit.com', pass: '123', name: 'System Admin', role: 'admin', joined: '2023-01-01' },
                        { id: 'member@smashfit.com', pass: '123', name: 'Kennedy O.', role: 'member', wallet: 2500, plan: 'Gold', txns: [] },
                        { id: 'trainer@smashfit.com', pass: '123', name: 'Mike Tyson', role: 'trainer', special: 'Boxing' }
                    ];
                    const classes = [
                        { id: 'c1', name: 'Morning HIIT', time: '06:00 AM', trainer: 'Mike Tyson', price: 500, cap: 20, booked: [] },
                        { id: 'c2', name: 'Power Yoga', time: '08:00 AM', trainer: 'Sarah J.', price: 600, cap: 15, booked: [] },
                        { id: 'c3', name: 'Boxing Pro', time: '06:00 PM', trainer: 'Mike Tyson', price: 800, cap: 10, booked: [] },
                        { id: 'c4', name: 'CrossFit', time: '05:00 PM', trainer: 'Sarah J.', price: 750, cap: 12, booked: [] }
                    ];
                    localStorage.setItem('sf_users_v7', JSON.stringify(users));
                    localStorage.setItem('sf_classes_v7', JSON.stringify(classes));
                }
            },
            get(k) { return JSON.parse(localStorage.getItem(k + '_v7') || '[]'); },
            set(k, v) { localStorage.setItem(k + '_v7', JSON.stringify(v)); },
            
            findUser(e, p) { return this.get('sf_users').find(u => u.id === e && u.pass === p); },
            
            topUp(uid, amt) {
                const users = this.get('sf_users');
                const u = users.find(x => x.id === uid);
                if(u) {
                    u.wallet = (u.wallet || 0) + parseInt(amt);
                    if(!u.txns) u.txns = [];
                    u.txns.unshift({ desc: 'Wallet Deposit', amt: amt, date: 'Just now', type: 'credit' });
                    this.set('sf_users', users);
                    return true;
                }
                return false;
            },

            bookClass(uid, cid) {
                const users = this.get('sf_users');
                const classes = this.get('sf_classes');
                const u = users.find(x => x.id === uid);
                const c = classes.find(x => x.id === cid);

                if(c.booked.includes(uid)) return { ok: false, msg: "Already Booked" };
                if(c.booked.length >= c.cap) return { ok: false, msg: "Class Full" };
                if(u.wallet < c.price) return { ok: false, msg: "Insufficient Funds" };

                u.wallet -= c.price;
                if(!u.txns) u.txns = [];
                u.txns.unshift({ desc: `Class: ${c.name}`, amt: -c.price, date: 'Just now', type: 'debit' });
                c.booked.push(uid);

                this.set('sf_users', users);
                this.set('sf_classes', classes);
                return { ok: true, msg: "Booking Confirmed" };
            }
        };

        // --- 2. CONTROLLER ---
        const App = {
            user: null,

            init() {
                DB.init();
                document.getElementById('login-form').addEventListener('submit', (e) => {
                    e.preventDefault();
                    const u = DB.findUser(document.getElementById('login-email').value, document.getElementById('login-pass').value);
                    if(u) { this.user = u; this.launch(); } 
                    else { alert('Invalid Credentials'); }
                });
            },

            launch() {
                document.getElementById('auth-screen').style.display = 'none';
                document.getElementById('app-shell').classList.remove('hidden');
                document.getElementById('user-name').innerText = this.user.name;
                document.getElementById('user-role').innerText = this.user.role.toUpperCase();
                document.getElementById('user-initial').innerText = this.user.name.charAt(0);
                this.renderNav();
                this.navigate('dashboard');
            },

            renderNav() {
                const role = this.user.role;
                const dNav = document.getElementById('sidebar-nav');
                const mNav = document.getElementById('mobile-nav');
                dNav.innerHTML = ''; mNav.innerHTML = '';

                let routes = [];
                if(role === 'admin') routes = [
                    { id: 'dashboard', label: 'Overview', icon: 'dashboard' },
                    { id: 'users', label: 'Members', icon: 'group' },
                    { id: 'classes', label: 'Schedule', icon: 'calendar_today' }
                ];
                if(role === 'member') routes = [
                    { id: 'dashboard', label: 'Home', icon: 'home' },
                    { id: 'classes', label: 'Book', icon: 'fitness_center' },
                    { id: 'wallet', label: 'Wallet', icon: 'account_balance_wallet' }
                ];
                if(role === 'trainer') routes = [{ id: 'dashboard', label: 'My Classes', icon: 'list_alt' }];

                routes.forEach(r => {
                    dNav.innerHTML += `<li class="nav-item" id="nav-${r.id}" onclick="App.navigate('${r.id}')"><i class="material-icons-round">${r.icon}</i> ${r.label}</li>`;
                    mNav.innerHTML += `<button class="nav-btn" onclick="App.navigate('${r.id}')"><i class="material-icons-round">${r.icon}</i>${r.label}</button>`;
                });
            },

            navigate(viewId) {
                const container = document.getElementById('main-view');
                const role = this.user.role;
                document.querySelectorAll('.nav-item').forEach(e => e.classList.remove('active'));
                const nav = document.getElementById(`nav-${viewId}`);
                if(nav) nav.classList.add('active');

                const users = DB.get('sf_users');
                const classes = DB.get('sf_classes');

                // --- ADMIN DASHBOARD ---
                if(role === 'admin' && viewId === 'dashboard') {
                    const totalMembers = users.filter(u => u.role === 'member').length;
                    const totalRev = users.reduce((acc, u) => acc + (u.wallet || 0), 0);
                    
                    container.innerHTML = `
                        <div class="flex-between" style="margin-bottom:30px;">
                            <h2>Overview</h2>
                            <span class="text-sm text-accent">‚óè System Online</span>
                        </div>
                        <div class="bento-grid">
                            <div class="card span-1">
                                <div class="text-sm text-secondary">Total Members</div>
                                <div style="font-size:2.5rem; font-weight:700;">${totalMembers}</div>
                                <div class="text-xs text-accent">+12% this month</div>
                            </div>
                            <div class="card span-1">
                                <div class="text-sm text-secondary">Wallet Float</div>
                                <div style="font-size:2.5rem; font-weight:700; color:#fff;">KES ${totalRev.toLocaleString()}</div>
                            </div>
                            <div class="card span-2">
                                <div class="flex-between">
                                    <h3 class="text-sm text-secondary">Revenue Trend</h3>
                                    <i class="material-icons-round text-secondary">trending_up</i>
                                </div>
                                <div class="chart-container">
                                    <div class="bar" style="height:40%"></div>
                                    <div class="bar" style="height:60%"></div>
                                    <div class="bar" style="height:35%"></div>
                                    <div class="bar" style="height:80%"></div>
                                    <div class="bar active" style="height:65%"></div>
                                    <div class="bar" style="height:50%"></div>
                                </div>
                            </div>
                            <div class="card span-2">
                                <h3 style="margin-bottom:15px;">Recent Logins</h3>
                                <div class="activity-item">
                                    <div class="activity-icon"><i class="material-icons-round">person</i></div>
                                    <div style="flex:1">
                                        <div style="font-weight:500">Kennedy O.</div>
                                        <div class="text-xs">Checked in at Front Desk</div>
                                    </div>
                                    <span class="text-xs">2m ago</span>
                                </div>
                                <div class="activity-item">
                                    <div class="activity-icon"><i class="material-icons-round">person</i></div>
                                    <div style="flex:1">
                                        <div style="font-weight:500">Mike Tyson</div>
                                        <div class="text-xs">Started 'Morning HIIT'</div>
                                    </div>
                                    <span class="text-xs">15m ago</span>
                                </div>
                            </div>
                            <div class="card span-2">
                                <h3 style="margin-bottom:15px;">Quick Actions</h3>
                                <div style="display:flex; gap:10px;">
                                    <button class="btn btn-ghost full-width" onclick="App.modalAddUser()">+ Add User</button>
                                    <button class="btn btn-ghost full-width" onclick="App.modalAddClass()">+ Add Class</button>
                                </div>
                            </div>
                        </div>
                    `;
                }
                // --- ADMIN USER LIST ---
                else if (role === 'admin' && viewId === 'users') {
                    container.innerHTML = `
                        <div class="flex-between" style="margin-bottom:20px;">
                            <h2>Members & Staff</h2>
                            <button class="btn btn-primary" onclick="App.modalAddUser()">New User</button>
                        </div>
                        <div class="bento-grid">
                            ${users.map(u => `
                                <div class="card span-1" style="padding:20px;">
                                    <div class="flex-between" style="margin-bottom:15px;">
                                        <div style="width:40px; height:40px; border-radius:10px; background:var(--bg-hover); display:grid; place-items:center; font-weight:700;">${u.name.charAt(0)}</div>
                                        <span class="badge" style="color:${u.role==='admin'?'var(--danger)':(u.role==='member'?'var(--primary)':'var(--secondary)')}">${u.role}</span>
                                    </div>
                                    <div style="font-weight:600; font-size:1.1rem;">${u.name}</div>
                                    <div class="text-xs text-secondary" style="margin-bottom:15px;">${u.id}</div>
                                    ${u.role === 'member' ? `<button class="btn btn-ghost full-width" style="font-size:0.8rem; padding:8px;" onclick="App.actionTopUp('${u.id}')">Top Up Wallet</button>` : ''}
                                </div>
                            `).join('')}
                        </div>
                    `;
                }
                // --- ADMIN CLASSES ---
                else if (role === 'admin' && viewId === 'classes') {
                    container.innerHTML = `
                        <div class="flex-between" style="margin-bottom:20px;">
                            <h2>Class Schedule</h2>
                            <button class="btn btn-primary" onclick="App.modalAddClass()">New Class</button>
                        </div>
                        <div class="bento-grid">
                            ${classes.map(c => `
                                <div class="card span-1">
                                    <div class="flex-between" style="margin-bottom:10px;">
                                        <span class="badge">${c.time}</span>
                                        <span class="text-accent font-mono">KES ${c.price}</span>
                                    </div>
                                    <h3>${c.name}</h3>
                                    <p class="text-xs text-secondary" style="margin-bottom:15px;">${c.trainer}</p>
                                    <div style="background:var(--bg-hover); padding:8px; border-radius:6px; font-size:0.85rem; text-align:center;">
                                        ${c.booked.length} / ${c.cap} Booked
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                    `;
                }

                // --- MEMBER DASHBOARD ---
                else if(role === 'member') {
                    this.user = users.find(u => u.id === this.user.id); // Refresh
                    const me = this.user;
                    
                    if(viewId === 'dashboard') {
                        container.innerHTML = `
                            <div class="bento-grid">
                                <div class="card span-2" style="background: linear-gradient(135deg, rgba(34, 197, 94, 0.1), rgba(0,0,0,0)); border: 1px solid rgba(34, 197, 94, 0.3);">
                                    <div class="text-sm text-secondary">Wallet Balance</div>
                                    <div style="font-size:3.5rem; font-weight:700; margin:10px 0; letter-spacing:-1px;">KES ${me.wallet.toLocaleString()}</div>
                                    <div class="flex-between">
                                        <span class="text-xs">ID: ${me.id}</span>
                                        <button class="btn btn-ghost" style="padding:6px 12px; font-size:0.75rem;">View History</button>
                                    </div>
                                </div>
                                
                                <div class="card span-2">
                                    <div class="text-sm text-secondary">Next Class</div>
                                    <div style="font-size:1.5rem; font-weight:700; margin:10px 0;">Morning HIIT</div>
                                    <div class="flex-between">
                                        <span class="badge">06:00 AM</span>
                                        <span class="text-xs text-accent">Tomorrow</span>
                                    </div>
                                </div>

                                <div class="card span-4">
                                    <h3 class="text-sm text-secondary">Weekly Consistency</h3>
                                    <div class="chart-container" style="height:150px;">
                                        <div class="bar" style="height:30%"></div>
                                        <div class="bar" style="height:50%"></div>
                                        <div class="bar" style="height:20%"></div>
                                        <div class="bar active" style="height:80%"></div>
                                        <div class="bar" style="height:60%"></div>
                                        <div class="bar" style="height:90%"></div>
                                        <div class="bar" style="height:40%"></div>
                                    </div>
                                </div>
                            </div>
                        `;
                    }
                    else if (viewId === 'classes') {
                        container.innerHTML = `
                            <h2>Book a Class</h2>
                            <div class="bento-grid" style="margin-top:20px;">
                                ${classes.map(c => {
                                    const isBooked = c.booked.includes(me.id);
                                    return `
                                        <div class="card span-1" style="border:${isBooked ? '1px solid var(--primary)':''}">
                                            <div class="flex-between" style="margin-bottom:10px;">
                                                <span class="badge">${c.time}</span>
                                                <span class="text-accent font-mono">KES ${c.price}</span>
                                            </div>
                                            <h3>${c.name}</h3>
                                            <p class="text-xs text-secondary" style="margin-bottom:15px;">${c.trainer}</p>
                                            ${isBooked ? 
                                                `<button class="btn btn-ghost full-width" style="color:var(--primary)" disabled>Booked</button>` :
                                                `<button class="btn btn-primary full-width" onclick="App.actionBook('${c.id}')">Book Now</button>`
                                            }
                                        </div>
                                    `;
                                }).join('')}
                            </div>
                        `;
                    }
                    else if (viewId === 'wallet') {
                        const txns = me.txns || [];
                        container.innerHTML = `
                            <h2>Transaction History</h2>
                            <div class="card" style="margin-top:20px; padding:0;">
                                ${txns.map(t => `
                                    <div class="activity-item" style="padding:15px 20px;">
                                        <div class="activity-icon" style="color:${t.type==='credit'?'var(--primary)':'var(--danger)'}">
                                            <i class="material-icons-round">${t.type==='credit'?'arrow_downward':'arrow_upward'}</i>
                                        </div>
                                        <div style="flex:1">
                                            <div style="font-weight:600;">${t.desc}</div>
                                            <div class="text-xs text-secondary">${t.date}</div>
                                        </div>
                                        <div class="font-mono" style="color:${t.type==='credit'?'var(--primary)':'#fff'}">
                                            ${t.type==='credit'?'+':''}${t.amt}
                                        </div>
                                    </div>
                                `).join('')}
                                ${txns.length===0 ? '<div style="padding:30px; text-align:center" class="text-secondary">No history found.</div>' : ''}
                            </div>
                        `;
                    }
                }
            },

            // --- ACTIONS ---
            modalAddUser() {
                document.getElementById('modal-content').innerHTML = `
                    <div style="padding:24px;">
                        <h3 style="margin-bottom:20px;">Add User</h3>
                        <form onsubmit="App.performAddUser(event)">
                            <select id="n-role"><option value="member">Member</option><option value="trainer">Trainer</option><option value="admin">Admin</option></select>
                            <input id="n-email" placeholder="Email" required>
                            <input id="n-name" placeholder="Name" required>
                            <input id="n-pass" value="123" placeholder="Password">
                            <button class="btn btn-primary full-width">Create</button>
                        </form>
                        <button class="btn btn-ghost full-width" style="margin-top:10px;" onclick="App.closeModal()">Cancel</button>
                    </div>
                `;
                document.getElementById('modal-overlay').style.display = 'flex';
            },
            
            modalAddClass() {
                document.getElementById('modal-content').innerHTML = `
                    <div style="padding:24px;">
                        <h3 style="margin-bottom:20px;">Add Class</h3>
                        <form onsubmit="App.performAddClass(event)">
                            <input id="c-name" placeholder="Class Name" required>
                            <input id="c-time" placeholder="09:00 AM" required>
                            <input id="c-trainer" placeholder="Trainer Name" required>
                            <input id="c-price" type="number" placeholder="Price (KES)" required>
                            <button class="btn btn-primary full-width">Publish</button>
                        </form>
                        <button class="btn btn-ghost full-width" style="margin-top:10px;" onclick="App.closeModal()">Cancel</button>
                    </div>
                `;
                document.getElementById('modal-overlay').style.display = 'flex';
            },

            performAddUser(e) {
                e.preventDefault();
                const u = {
                    id: document.getElementById('n-email').value,
                    name: document.getElementById('n-name').value,
                    pass: document.getElementById('n-pass').value,
                    role: document.getElementById('n-role').value,
                    wallet: 0, txns: []
                };
                const users = DB.get('sf_users');
                users.push(u);
                DB.set('sf_users', users);
                this.closeModal();
                this.toast('User Added');
                this.navigate('users');
            },

            performAddClass(e) {
                e.preventDefault();
                const c = {
                    id: 'c'+Date.now(),
                    name: document.getElementById('c-name').value,
                    time: document.getElementById('c-time').value,
                    trainer: document.getElementById('c-trainer').value,
                    price: parseInt(document.getElementById('c-price').value),
                    cap: 20, booked: []
                };
                const classes = DB.get('sf_classes');
                classes.push(c);
                DB.set('sf_classes', classes);
                this.closeModal();
                this.toast('Class Published');
                this.navigate('classes');
            },

            actionTopUp(uid) {
                const amt = prompt("Enter Amount (KES):");
                if(amt && DB.topUp(uid, amt)) { this.toast('Wallet Updated'); this.navigate('users'); }
            },

            actionBook(cid) {
                if(!confirm("Confirm Booking?")) return;
                const res = DB.bookClass(this.user.id, cid);
                if(res.ok) { this.toast(res.msg); this.navigate('classes'); } 
                else { alert(res.msg); }
            },

            closeModal() { document.getElementById('modal-overlay').style.display = 'none'; },
            
            toast(msg) {
                const t = document.getElementById('toast');
                t.innerText = msg;
                t.style.transform = 'translateY(0)';
                setTimeout(() => t.style.transform = 'translateY(100px)', 3000);
            },

            factoryReset() {
                if(confirm("Reset Database?")) { localStorage.clear(); location.reload(); }
            }
        };

        App.init();
    </script>
</body>
</html>